<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="{{ path('app_home') }}">
            <i class="bi bi-speedometer2"></i> TechOffice
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link {{ app.request.attributes.get('_route') == 'app_home' ? 'active' : '' }}" href="{{ path('app_home') }}">
                        <i class="bi bi-house-door"></i> <span class="d-none d-md-inline">Accueil</span>
                    </a>
                </li>
                
                {% if app.user %}
                    {# Menu principal - Parc #}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'app_site' or app.request.attributes.get('_route') starts with 'app_imprimante' ? 'active' : '' }}" href="#" id="parcDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-building"></i> <span class="d-none d-md-inline">Parc</span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="parcDropdown">
                            <li><h6 class="dropdown-header">Sites</h6></li>
                            <li><a class="dropdown-item" href="{{ path('app_site_index') }}">
                                <i class="bi bi-list-ul"></i> Liste des sites
                            </a></li>
                            <li><a class="dropdown-item" href="{{ path('app_site_new') }}">
                                <i class="bi bi-plus-circle"></i> Nouveau site
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Imprimantes</h6></li>
                            <li><a class="dropdown-item" href="{{ path('app_imprimante_index') }}">
                                <i class="bi bi-list-ul"></i> Liste des imprimantes
                            </a></li>
                            <li><a class="dropdown-item" href="{{ path('app_imprimante_new') }}">
                                <i class="bi bi-plus-circle"></i> Nouvelle imprimante
                            </a></li>
                        </ul>
                    </li>

                    {# Menu Stock #}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'app_stock' or app.request.attributes.get('_route') starts with 'app_piece' ? 'active' : '' }}" href="#" id="stockDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-box-seam"></i> <span class="d-none d-md-inline">Stock</span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="stockDropdown">
                            <li><a class="dropdown-item" href="{{ path('app_stock_location_index') }}">
                                <i class="bi bi-geo-alt"></i> Emplacements de stock
                            </a></li>
                            <li><a class="dropdown-item" href="{{ path('app_piece_index') }}">
                                <i class="bi bi-puzzle"></i> Catalogue des pièces
                            </a></li>
                            <li><a class="dropdown-item" href="{{ path('app_stock_item_index') }}">
                                <i class="bi bi-box"></i> Quantités en stock
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ path('app_piece_modele_index') }}">
                                <i class="bi bi-link-45deg"></i> Compatibilités
                            </a></li>
                        </ul>
                    </li>

                    {# Menu Interventions #}
                    <li class="nav-item">
                        <a class="nav-link {{ app.request.attributes.get('_route') starts with 'app_intervention' ? 'active' : '' }}" href="{{ path('app_intervention_index') }}">
                            <i class="bi bi-tools"></i> <span class="d-none d-md-inline">Interventions</span>
                        </a>
                    </li>

                    {# Menu Clients #}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'app_client' ? 'active' : '' }}" href="#" id="clientsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-people"></i> <span class="d-none d-md-inline">Clients</span>
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="clientsDropdown">
                            <li><a class="dropdown-item" href="{{ path('app_client_index') }}">
                                <i class="bi bi-list-ul"></i> Liste
                            </a></li>
                            <li><a class="dropdown-item" href="{{ path('app_client_new') }}">
                                <i class="bi bi-plus-circle"></i> Nouveau
                            </a></li>
                        </ul>
                    </li>

                    {# Menu Référentiel (admin) #}
                    {% if is_granted('ROLE_ADMIN') %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'app_fabricant' or app.request.attributes.get('_route') starts with 'app_modele' ? 'active' : '' }}" href="#" id="referentielDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-database"></i> <span class="d-none d-md-inline">Référentiel</span>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="referentielDropdown">
                                <li><h6 class="dropdown-header">Fabricants</h6></li>
                                <li><a class="dropdown-item" href="{{ path('app_fabricant_index') }}">Liste</a></li>
                                <li><a class="dropdown-item" href="{{ path('app_fabricant_new') }}">Nouveau</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><h6 class="dropdown-header">Modèles</h6></li>
                                <li><a class="dropdown-item" href="{{ path('app_modele_index') }}">Liste</a></li>
                                <li><a class="dropdown-item" href="{{ path('app_modele_new') }}">Nouveau</a></li>
                            </ul>
                        </li>
                    {% endif %}

                    {# Menu Comptabilité (comptable + admin) #}
                    {% if is_granted('ROLE_COMPTABLE') or is_granted('ROLE_ADMIN') %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'app_comptabilite' ? 'active' : '' }}" href="#" id="comptabiliteDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-calculator"></i> <span class="d-none d-md-inline">Comptabilité</span>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="comptabiliteDropdown">
                                <li><a class="dropdown-item" href="{{ path('app_comptabilite_dashboard') }}">
                                    <i class="bi bi-speedometer2"></i> Tableau de bord
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ path('app_comptabilite_periodes') }}">
                                    <i class="bi bi-calendar-range"></i> Périodes de facturation
                                </a></li>
                                <li><a class="dropdown-item" href="{{ path('app_comptabilite_contrats') }}">
                                    <i class="bi bi-file-earmark-text"></i> Contrats
                                </a></li>
                            </ul>
                        </li>
                    {% endif %}

                    {# Menu Administration (admin) #}
                    {% if is_granted('ROLE_ADMIN') %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle {{ app.request.attributes.get('_route') starts with 'app_user' or app.request.attributes.get('_route') starts with 'app_demande_conge' ? 'active' : '' }}" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-gear"></i> <span class="d-none d-md-inline">Admin</span>
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                                <li><a class="dropdown-item" href="{{ path('app_user_index') }}">
                                    <i class="bi bi-people"></i> Utilisateurs
                                </a></li>
                                <li><a class="dropdown-item" href="{{ path('app_demande_conge_index') }}">
                                    <i class="bi bi-calendar-check"></i> Demandes de congé
                                </a></li>
                            </ul>
                        </li>
                    {% endif %}

                    {# Import CSV #}
                    <li class="nav-item">
                        <a class="nav-link {{ app.request.attributes.get('_route') == 'app_import' ? 'active' : '' }}" href="{{ path('app_import') }}">
                            <i class="bi bi-upload"></i> <span class="d-none d-md-inline">Import CSV</span>
                        </a>
                    </li>
                {% endif %}
            </ul>

            {# Menu utilisateur #}
            <ul class="navbar-nav">
                {% if app.user %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-white" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle"></i> 
                            <span class="d-none d-md-inline">{{ app.user.nom ?? app.user.email }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><h6 class="dropdown-header">{{ app.user.email }}</h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ path('app_logout') }}">
                                <i class="bi bi-box-arrow-right"></i> Déconnexion
                            </a></li>
                        </ul>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link text-white" href="{{ path('app_login') }}">
                            <i class="bi bi-box-arrow-in-right"></i> <span class="d-none d-md-inline">Connexion</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<script>
// Fermeture automatique du menu mobile après clic
document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('#navbarNav .nav-link:not(.dropdown-toggle)');
    const navbarCollapse = document.querySelector('#navbarNav');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth < 992) { // Bootstrap lg breakpoint
                const bsCollapse = bootstrap.Collapse.getInstance(navbarCollapse);
                if (bsCollapse) {
                    bsCollapse.hide();
                }
            }
        });
    });
});
</script>
